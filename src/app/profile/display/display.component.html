<div class="container  ">
  <div class="d-flex justify-content-center pt-4 ">
    <div class="d-flex w-100 flex-column flex-md-row align-items-center gap-4">
      <!-- Profile Image -->
      <div>
        <img [src]="avatarUrl || 'assets/avatar.png'"  data-bs-toggle="modal" data-bs-target="#profileModal"  alt="Profile" class="rounded-circle border"
          style="width: 120px; height: 120px; object-fit: cover;">
      </div>

      <!-- Profile Info -->
      <div class="flex-grow-1 ms-md-5 text-center text-md-start">
        <!-- Username + Edit -->
        <div class="d-flex align-items-center justify-content-center justify-content-md-start mb-3 flex-wrap gap-2">
          <h3 class="mb-0 me-2">{{ username }}</h3>
          <button *ngIf="loggedInUserName == username" class="btn btn-outline-secondary btn-sm" routerLink="/accounts/edit-profile">Edit Profile</button>
          <button *ngIf="loggedInUserName != username && !alreadyFollowing && !isRequested && !isSeenUserFollwingMeVariable"(click)="Follow() " class="btn btn-primary px-3 ms-3 btn-sm"  >Follow</button>
          <button *ngIf="loggedInUserName != username && !alreadyFollowing && !isRequested && isSeenUserFollwingMeVariable"(click)="Follow() " class="btn btn-primary px-3 ms-3 btn-sm"  >Follow Back</button>
          <button *ngIf="loggedInUserName != username && !alreadyFollowing && isRequested" (click)="RemoveRequest()" class="btn btn-secondary px-3 ms-3 btn-sm"  >Requested</button>
          <button *ngIf="loggedInUserName != username && alreadyFollowing"(click)="UnFollow()" class="btn btn-secondary px-3 ms-3 btn-sm"  >UnFollow</button>
          <!-- <button *ngIf="loggedInUserName != username"  class="btn btn-primary px-3 ms-3  btn-sm"  >Follow</button> -->
        </div>

        <!-- Stats -->
        <div class="d-flex justify-content-center justify-content-md-start gap-5 mb-3">
          <span><strong>{{ numberposts }}</strong> <span style="color: rgb(172, 172, 172);"> posts</span></span>
          <span (click)="GetFollowers()" data-bs-toggle="modal" data-bs-target="#follower" ><strong>{{ followers }}</strong> <span style="color: rgb(172, 172, 172); cursor: pointer;"> followers</span></span>
          <span (click)="GetFollowing()" data-bs-toggle="modal" data-bs-target="#following" ><strong>{{ following }}</strong> <span style="color: rgb(172, 172, 172); cursor: pointer;"> following</span></span>
        </div>

       <!-- Bio -->
        <div style=" word-wrap: break-word; overflow-wrap: break-word; max-height: 200px; overflow: auto;">
          <p class="fs-5">{{ fullname }}</p>
          <span [innerText]="bio"></span>
        </div>
        <!-- Mutual Friends Section -->
        <div *ngIf="mutualFriends.length > 0" class="d-flex align-items-center mt-2">
          <div class="d-flex align-items-center">
            <!-- Show up to 3 mutual friends profile pictures -->
            <ng-container *ngFor="let friend of mutualFriends.slice(0, 2)">
              <img [src]="getProfileImage(friend.profilePicture)"
                  class="rounded-circle border me-1"
                  width="30" height="30"
                  style="object-fit: cover;">
            </ng-container>
          </div>
          <div class="ms-2 small">
            <span *ngIf="mutualFriends.length === 1">
              Followed by {{ mutualFriends[0].userName }}
            </span>
            <span *ngIf="mutualFriends.length === 2">
              Followed by {{ mutualFriends[0].userName }} and {{ mutualFriends[1].userName }}
            </span>
            <span *ngIf="mutualFriends.length > 2"  data-bs-toggle="modal" data-bs-target="#mutual" >
              Followed by {{ mutualFriends[0].userName }}, {{ mutualFriends[1].userName }} and {{ mutualFriends.length - 2 }} others
            </span>
          </div>
        </div>

      </div>
    </div>
  </div>



  <!-- New Post Section --> 
   <div
  class="d-flex align-items-center justify-content-start w-100 mt-4 highlight-container"
>
  <!-- Add Highlight Button -->
  <div *ngIf="loggedInUserName == username"
    class="highlight-add d-flex flex-column align-items-center me-3"
  >
    <img data-bs-toggle="modal"
    data-bs-target="#hightlight"
      [src]="plusIconUrl"
      alt="Add Highlight"
      class="highlight-avatar"
    />
    <div class="text-center small mt-1">New</div>
  </div>

  <!-- Scrollable Highlights -->
  <div class="highlight-scroll flex-nowrap overflow-auto">
    <div
      *ngFor="let high of highlight"
      class="highlight-item text-center me-3"
    >
      <div class="highlight-ring p-1" *ngIf="loggedInUserName == username">
        <img (click)="onWhichAddImage(high);" data-bs-toggle="modal" data-bs-target="#hightlightimage"  
          [src]="getProfileImage(high.thumbnailUrl) || 'assets/avatar.png'"
          class="highlight-avatar"
          alt="Highlight"
          style="cursor: pointer;"
        />
      </div>
      <div class="highlight-ring p-1" *ngIf="loggedInUserName != username">
        <img (click)="openHighlightStory(high);"
          [src]="getProfileImage(high.thumbnailUrl) || 'assets/avatar.png'"
          class="highlight-avatar"
          alt="Highlight"
          style="cursor: pointer;"
        />
      </div>
      <div class="small mt-1 text-truncate">{{ high.title }}</div>
    </div>
  </div>
</div>
    

    <!-- Tabs -->
<ul class="nav justify-content-center   py-2" *ngIf="loggedInUserName != username && ( isPublic|| alreadyFollowing ) || loggedInUserName == username">
  <li class="nav-item">
    <a class="nav-link text-white" style="cursor: pointer;" [ngClass]="{active: activeTab === 'posts'}" (click)="activeTab = 'posts'">
      <i class="fa-solid fa-table-cells"></i> POSTS
    </a>
  </li>
  <li class="nav-item">
    <a class="nav-link text-white" style="cursor: pointer;" [ngClass]="{active: activeTab === 'reels'}"  (click)="activeTab = 'reels'" >
      <i class="fa-solid fa-film"></i> REELS
    </a>
  </li>
  <li class="nav-item" *ngIf="loggedInUserName == username">
    <a class="nav-link text-white" style="cursor: pointer;" [ngClass]="{active: activeTab === 'saved'}" (click)="activeTab = 'saved'" >
      <i class="fa-solid fa-bookmark"></i> SAVED
    </a>
  </li>
  <li class="nav-item">
    <a class="nav-link text-white" style="cursor: pointer;" [ngClass]="{active: activeTab === 'tagged'}"  (click)="activeTab = 'tagged'"  >
      <i class="fa-solid fa-user-tag"></i> TAGGED
    </a>
  </li>
</ul>

<!-- Posts Grid     -->
<div class="container mt-3 pb-5">
 <div *ngIf="activeTab === 'posts' && (isPublic || alreadyFollowing || loggedInUserName == username)" 
     class="post-grid mb-3">
  
  <div class="post-card" *ngFor="let post of fullDetailPost">
    <img [src]="'data:image/jpeg;base64,' + post.imageUrl" 
         alt="Post" 
         class="post-image">
    
    <!-- Overlay -->
    <div class="overlay d-flex justify-content-center align-items-center"
         (click)="openPostPage(post.postId)">
      <div class="text-white d-flex gap-3 fs-5 fw-bold">
        <span><i class="fas fa-heart"></i> {{ post.likesCount }}</span>
        <span><i class="fas fa-comment"></i> {{ post.commentsCount }}</span>
      </div>
    </div>
  </div>
</div>
<div class="" *ngIf="activeTab === 'reels'">
  <app-displayreels [isPublic]="isPublic" [alreadyFollowing]="alreadyFollowing" [loggedInUserName]="loggedInUserName" [username]="username" ></app-displayreels> 
</div>
<div class="" *ngIf="activeTab === 'saved'">
  <app-display-saved [isPublic]="isPublic" [alreadyFollowing]="alreadyFollowing" [loggedInUserName]="loggedInUserName" [username]="username" ></app-display-saved> 
</div>
<div class="" *ngIf="activeTab === 'tagged'">
  <app-display-tagged [isPublic]="isPublic" [alreadyFollowing]="alreadyFollowing" [loggedInUserName]="loggedInUserName" [username]="username" ></app-display-tagged> 
</div>
  
  <div *ngIf="!isPostAvailable && loggedInUserName == username && activeTab=='posts'" class="text-center py-2 " >
    <i class="fa-solid fs-1 fa-table-cells"></i>
    <p class="fw-bold fs-2" >Share Photos</p>
    <p> When you share photos, they will appear on your profile.</p> 

    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createModal"  >Share your first photo</button>
  </div>
  <div *ngIf="!isPostAvailable && loggedInUserName != username && ( isPublic|| alreadyFollowing ) && activeTab === 'posts'" class="text-center py-2 " >
    <i class="fa-solid fa-camera  fs-1"></i>
    <p class="fw-bold fs-2 mt-3" >No Posts Yet</p>  
  </div>
  <div *ngIf="loggedInUserName != username && !( isPublic|| alreadyFollowing ) && activeTab === 'posts'" class="text-center py-2 " >
    <i class="fa-solid fa-lock  fs-1"></i>
    <p class="fw-bold fs-2 mt-3" >This account is private</p>
    <p>Follow to see their photos and videos.</p>  
  </div>
</div>

<!-- Bootstrap profile Modal -->
<div *ngIf="loggedInUserName == username" class="modal fade" id="profileModal" tabindex="-1" aria-labelledby="profileModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-center " style="background-color: rgb(38, 38, 38);">
      <div class="modal-header border-0">
        <h5 class="modal-title w-100" id="profileModalLabel">Change Profile Photo</h5>
      </div>
      <div class="modal-body p-0">
        <button class="btn w-100 text-primary fw-bold border-top" (click)="triggerFileInput()">Upload Photo</button>
        <button class="btn w-100 text-danger border-top" (click)="removePhoto()">Remove Current Photo</button>
        <button class="btn w-100 border-top text-white" #closeModal data-bs-dismiss="modal">Cancel</button>
      </div>
    </div>
  </div>
</div> 

<!-- follower Modal -->
<div class="modal fade" id="follower" tabindex="-1" aria-labelledby="followerLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" style="max-width: 400px;"> <!-- ðŸ‘ˆ Centered and limited width -->
    <div class="modal-content" style="background-color: #121212; color: white; border-radius: 12px;">

      <!-- Modal Header -->
      <div class="modal-header border-0" style="background-color: #1a1a1a;">
        <h5 class="modal-title mx-auto" id="followerLabel" style="font-weight: 600;">Follower</h5>
        <button type="button" class="btn-close btn-close-white position-absolute end-0 me-3" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <!-- Modal Body -->
      <div class="modal-body p-0" style="max-height: 350px; overflow-y: auto;"> <!-- ðŸ‘ˆ Scroll when needed -->

        <!-- Loop Over Likes -->
        
         <ng-template #elseBlock>
            <div class="search-item d-flex align-items-center gap-2 p-2 hover-effect"
              *ngFor="let like of follower" 
              data-bs-dismiss="modal" aria-label="Close"
              [routerLink]="['/', like.userName]"
              
            >
              <img [src]="getProfileImage(like.profilePicture)" class="rounded-circle" width="40" height="40" style="object-fit: cover;" />
              <div>
                <div class="fw-bold text-white">{{ like.userName }}</div>
                <div class=" small">{{ like.fullName }}</div>
              </div>
           </div>
         </ng-template>

    <div  *ngIf="loggedInUserName != username && !( isPublic|| alreadyFollowing ) else elseBlock" class="search-item d-flex align-items-center gap-2 p-2 hover-effect">
        <div class="fw-bold text-white">ID is Private</div>
    </div>


      </div>

    </div>
  </div>
</div>
<!-- following Modal -->
<div class="modal fade" id="following" tabindex="-1" aria-labelledby="followingLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" style="max-width: 400px;"> <!-- ðŸ‘ˆ Centered and limited width -->
    <div class="modal-content" style="background-color: #121212; color: white; border-radius: 12px;">

      <!-- Modal Header -->
      <div class="modal-header border-0" style="background-color: #1a1a1a;">
        <h5 class="modal-title mx-auto" id="followingLabel" style="font-weight: 600;">Following</h5>
        <button type="button" class="btn-close btn-close-white position-absolute end-0 me-3" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <!-- Modal Body -->
      <div class="modal-body p-0" style="max-height: 350px; overflow-y: auto;"> <!-- ðŸ‘ˆ Scroll when needed -->

        <ng-template #elseBlockfollowing>
          <!-- Loop Over Likes -->
          <div class="search-item d-flex align-items-center gap-2 p-2 hover-effect"
      *ngFor="let like of followingdata" 
      data-bs-dismiss="modal" aria-label="Close"
      [routerLink]="['/', like.userName]"
       
    >
      <img [src]="getProfileImage(like.profilePicture)" class="rounded-circle" width="40" height="40" style="object-fit: cover;" />
      <div>
        <div class="fw-bold text-white">{{ like.userName }}</div>
        <div class=" small">{{ like.fullName }}</div>
      </div>
    </div>
        </ng-template>
    <div  *ngIf="loggedInUserName != username && !( isPublic|| alreadyFollowing ) else elseBlockfollowing" class="search-item d-flex align-items-center gap-2 p-2 hover-effect">
        <div class="fw-bold text-white">ID is Private</div>
    </div>


      </div>

    </div>
  </div>
</div>
<!-- Mutual Modal -->
<div class="modal fade" id="mutual" tabindex="-1" aria-labelledby="mutualLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" style="max-width: 400px;"> <!-- ðŸ‘ˆ Centered and limited width -->
    <div class="modal-content" style="background-color: #121212; color: white; border-radius: 12px;">

      <!-- Modal Header -->
      <div class="modal-header border-0" style="background-color: #1a1a1a;">
        <h5 class="modal-title mx-auto" id="followingLabel" style="font-weight: 600;">Mutual Friends</h5>
        <button type="button" class="btn-close btn-close-white position-absolute end-0 me-3" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <!-- Modal Body -->
      <div class="modal-body p-0" style="max-height: 350px; overflow-y: auto;"> <!-- ðŸ‘ˆ Scroll when needed -->

          <!-- Loop Over Likes -->
          <div class="search-item d-flex align-items-center gap-2 p-2 hover-effect"
      *ngFor="let like of mutualFriends" 
      data-bs-dismiss="modal" aria-label="Close"
      [routerLink]="['/', like.userName]"
       
    >
      <img [src]="getProfileImage(like.profilePicture)" class="rounded-circle" width="40" height="40" style="object-fit: cover;" />
      <div>
        <div class="fw-bold text-white">{{ like.userName }}</div>
        <div class=" small">{{ like.fullName }}</div>
      </div>
    </div>


      </div>

    </div>
  </div>
</div>

<!-- hightlight Modal -->
<div class="modal fade" id="hightlight" tabindex="-1" aria-labelledby="hightlightLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" style="max-width: 400px;"> <!-- ðŸ‘ˆ Centered and limited width -->
    <div class="modal-content" style="background-color: #121212; color: white; border-radius: 12px;">

      <!-- Modal Header -->
      <div class="modal-header border-0" style="background-color: #1a1a1a;">
        <h5 class="modal-title mx-auto" id="followingLabel" style="font-weight: 600;">Add Highlight</h5>
        <button type="button" class="btn-close btn-close-white position-absolute end-0 me-3" data-bs-dismiss="modal" aria-label="Close" (click)="CloseHightLightModal()"></button>
      </div>

      <!-- Modal Body -->
      <div class="modal-body p-0" style="max-height: 350px; overflow-y: auto;"> <!-- ðŸ‘ˆ Scroll when needed -->

       <form (ngSubmit)="onSubmit($event,highlightForm)" #highlightForm="ngForm" enctype="multipart/form-data">

          <!-- Title Input -->
          <div class="mb-3 px-3">
            <label for="highlightTitle" class="form-label text-white">Title</label>
            <input
              type="text"
              id="highlightTitle"
              name="title"
              class="form-control"
              style="background-color: #1e1e1e; color: white; border: none;"
              placeholder="Enter highlight title"
              required
              ngModel
            />
          </div>

          <!-- Image Upload -->
          <div class="mb-3 px-3">
            <label for="highlightImage" class="form-label text-white">Image</label>
            <input
              type="file"
              id="highlightImage"
              name="image"
              class="form-control"
              style="background-color: #1e1e1e; color: white; border: none;"
              accept="image/*"
              (change)="onImageSelected($event)"
              required
               #fileInput
            />
          </div>

          <!-- Image Preview -->
          <div *ngIf="selectedImage" class="mb-3 text-center p-3">
            <img [src]="selectedImage"  alt="Preview" class="rounded" style="max-width: 100%; height: 150px; object-fit: cover;" />
          </div>

          <!-- Submit Button -->
          <div class="text-center">
            <button
              type="submit"
              class="btn btn-primary w-100"
              style="background-color: #007bff; border: none; border-radius: 8px;"
              [disabled]="!highlightForm.form.valid"
            >
              Add Highlight
            </button>
          </div>
        </form>


      </div>

    </div>
  </div>
</div>

<!-- hightlightimage Modal -->
<div class="modal fade" id="hightlightimage" tabindex="-1" aria-labelledby="hightlightimageLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" style="max-width: 400px;"> <!-- ðŸ‘ˆ Centered and limited width -->
    <div class="modal-content" style="background-color: #121212; color: white; border-radius: 12px;">

      <!-- Modal Header -->
      <div class="modal-header border-0" style="background-color: #1a1a1a;">
        <h5 class="modal-title mx-auto" id="followingLabel" style="font-weight: 600;">Add images in highlight</h5>
        <button type="button" class="btn-close btn-close-white position-absolute end-0 me-3" data-bs-dismiss="modal" aria-label="Close" (click)="CloseHightLightModalImages()"></button>
        
        <div type="button" class=" btn-danger btn position-absolute me-3" style="font-size: smaller;" data-bs-dismiss="modal" aria-label="Close" (click)="DeleteHightLightImage()" >Delete</div>
      </div>

      <!-- Modal Body -->
      <div class="modal-body p-0" style="max-height: 350px; overflow-y: auto;"> <!-- ðŸ‘ˆ Scroll when needed -->

       <form (ngSubmit)="onSubmitImages($event,highlightForm)" #highlightImagesForm="ngForm" enctype="multipart/form-data">

          <!-- Title Input -->
          <div class="mb-3 px-3">
            <label for="highlightTitle" class="form-label text-white">Title</label>
            <input
              type="text"
              id="highlightTitle"
              name="title"
              disabled="true"
              [(ngModel)]="selectedImageTitle"
              class="form-control"
              style="background-color: #1e1e1e; color: white; border: none;"
              required
              ngModel
            />
          </div>

          <!-- Image Upload -->
          <div class="mb-3 px-3">
            <label for="highlightImage" class="form-label text-white">Image</label>
            <input
              type="file"
              id="highlightImage"
              name="image"
              class="form-control"
              style="background-color: #1e1e1e; color: white; border: none;"
              accept="image/*"
               #fileInputImage
              (change)="onImageSelectedImage($event)"
              required
            />
          </div>

          <!-- Image Preview -->
          <div *ngIf="selectedImageImages" class="mb-3 px-3 text-center">
            <img [src]="selectedImageImages"  alt="Preview" class="rounded" style="max-width: 100%; height: 150px; object-fit: cover;" />
          </div>

          <!-- Submit Button -->
          <div class="text-center">
            <button
              type="submit"
              class="btn btn-primary w-100"
              style="background-color: #007bff; border: none; border-radius: 8px;"
            >
              Add Image
            </button>
          </div>
        </form>


      </div>

    </div>
  </div>
</div>
 
</div>


<input type="file" accept="image/*" style="display:none" #fileInput (change)="handleFileUpload($event)" /> 